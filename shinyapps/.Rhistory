shiny::runApp()
runApp()
runApp()
data <- read.csv2(
"../../extractions/bct_rhumato_2018.csv",
stringsAsFactors = FALSE,
fileEncoding="latin1",
na.strings = c("", " ", "NA")
)
data$Date.naiss <- dmy(data$Date.naiss)
data$Date.entree.resume <- dmy_hm(data$Date.entree.resume)
data$Date.sortie.resume <- dmy_hm(data$Date.sortie.resume)
data$GHM_num <- substr(data$GHM, 0, 2)
data$GHM_lettre <- substr(data$GHM, 3, 3)
data$Age <- (
as.duration(
interval(data$Date.naiss, date(data$Date.entree.resume))
) %/%
as.duration(years(1))
)
data$Mode.ent <- substr(data$Mode.ent, 0, 1)
data$Mode.ent <- (
ifelse(
data$Mode.ent == 0, "Transfert provisoire",
ifelse(
data$Mode.ent == 6, "Mutation",
ifelse(
data$Mode.ent == 7, "Transfert",
ifelse(
data$Mode.ent == 8, "Domicile", "Inconnu"
)
)
)
)
)
data$Mode.sor <- substr(data$Mode.sor, 0, 1)
data$Mode.sor <- (
ifelse(
data$Mode.sor == 0, "Transfert provisoire",
ifelse(
data$Mode.sor == 6, "Mutation",
ifelse(
data$Mode.sor == 7, "Transfert",
ifelse(
data$Mode.sor == 8, "Domicile",
ifelse(
data$Mode.sor == 8, "Deces", "Inconnu"
)
)
)
)
)
)
data$Provenance.G <- substr(data$Provenance.G, 0, 1)
data$Provenance.G <- (
ifelse(
data$Provenance.G == 1, "MCO",
ifelse(
data$Provenance.G == 2, "SSR", #urgences ???
ifelse(
data$Provenance.G == 3, "SLD",
ifelse(
data$Provenance.G == 4, "PSY",
ifelse(
data$Provenance.G == 5, "Urgences", data$Provenance.G
)
)
)
)
)
)
data$annee.entree <- as.factor(year(data$Date.entree.resume))
data$mois.entree <- as.factor(month(data$Date.entree.resume))
data$diagnoses = apply(
data[, diagnoses],
1,
function(x) unname(c(x[!is.na(x)]))
)
data = data[, !names(data) %in% diagnoses]
diagnoses = c(
"CIM.principal",
"Diag.Relie",
"CIM.SIGN.1",
"CIM.SIGN.2",
"CIM.SIGN.3",
"CIM.SIGN.4",
"CIM.SIGN.5",
"CIM.SIGN.6",
"CIM.SIGN.7",
"CIM.SIGN.8",
"CIM.SIGN.9",
"CIM.SIGN.10",
"CIM.SIGN.11",
"CIM.SIGN.12",
"CIM.SIGN.13",
"CIM.SIGN.14",
"CIM.SIGN.15",
"CIM.SIGN.16",
"CIM.SIGN.17",
"CIM.SIGN.18",
"CIM.SIGN.19",
"CIM.SIGN.20"
)
keep_columns = c(
c(
"No.resume",
"NIP",
"NDA",
"Date.naiss",
"Code.post.Resid",
"UH",
"Date.entree.resume",
"Date.sortie.resume",
"Mode.ent",
"Mode.sor",
"Duree.sejour",
"GHM",
"GHS"
),
"diagnoses"
)
data <- read.csv2(
"../../extractions/bct_rhumato_2018.csv",
stringsAsFactors = FALSE,
fileEncoding="latin1",
na.strings = c("", " ", "NA")
)
data$Date.naiss <- dmy(data$Date.naiss)
data$Date.entree.resume <- dmy_hm(data$Date.entree.resume)
data$Date.sortie.resume <- dmy_hm(data$Date.sortie.resume)
data$GHM_num <- substr(data$GHM, 0, 2)
data$GHM_lettre <- substr(data$GHM, 3, 3)
data$Age <- (
as.duration(
interval(data$Date.naiss, date(data$Date.entree.resume))
) %/%
as.duration(years(1))
)
data$Mode.ent <- substr(data$Mode.ent, 0, 1)
data$Mode.ent <- (
ifelse(
data$Mode.ent == 0, "Transfert provisoire",
ifelse(
data$Mode.ent == 6, "Mutation",
ifelse(
data$Mode.ent == 7, "Transfert",
ifelse(
data$Mode.ent == 8, "Domicile", "Inconnu"
)
)
)
)
)
data$Mode.sor <- substr(data$Mode.sor, 0, 1)
data$Mode.sor <- (
ifelse(
data$Mode.sor == 0, "Transfert provisoire",
ifelse(
data$Mode.sor == 6, "Mutation",
ifelse(
data$Mode.sor == 7, "Transfert",
ifelse(
data$Mode.sor == 8, "Domicile",
ifelse(
data$Mode.sor == 8, "Deces", "Inconnu"
)
)
)
)
)
)
data$Provenance.G <- substr(data$Provenance.G, 0, 1)
data$Provenance.G <- (
ifelse(
data$Provenance.G == 1, "MCO",
ifelse(
data$Provenance.G == 2, "SSR", #urgences ???
ifelse(
data$Provenance.G == 3, "SLD",
ifelse(
data$Provenance.G == 4, "PSY",
ifelse(
data$Provenance.G == 5, "Urgences", data$Provenance.G
)
)
)
)
)
)
data$annee.entree <- as.factor(year(data$Date.entree.resume))
data$mois.entree <- as.factor(month(data$Date.entree.resume))
data$diagnoses = apply(
data[, diagnoses],
1,
function(x) unname(c(x[!is.na(x)]))
)
data = data[, !names(data) %in% diagnoses]
data = data[,keep_columns]
View(data)
"M313" %in% data$diagnoses
data$diagnoses
apply(data$diagnoses, 1, function(x) "M313" in unlist(x))
apply(data$diagnoses, 1, function(x) "M313" %in% unlist(x))
apply(data$diagnoses, 1, function(x) "M313" %in% unlist(c(x)))
apply(data$diagnoses, 0, function(x) "M313" %in% unlist(x))
apply(data, 1, function(x) "M313" %in% unlist(x$diagnoses))
sum(apply(data, 1, function(x) "M313" %in% unlist(x$diagnoses)))
sum(apply(data, 1, function(x) "M350" %in% unlist(x$diagnoses)))
runApp()
runApp()
substr(data$Code.post.Resid, 1, 2)
runApp()
runApp()
